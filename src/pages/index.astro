---
import { fetchAPI, getStrapiMediaUrl } from '../lib/strapi';

const data = await fetchAPI('/api/blog-posts?populate=cover');
const posts = data.data;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>My Blog</title>
  </head>
  <body>
    <h1>My Blog Posts</h1>
    
    <main>
      {posts && posts.length > 0 ? (
        posts.map((post) => (
          <article>
            <h2>
              <a href={`/posts/${post.attributes.Slug}`}>
                {post.attributes.title}
              </a>
            </h2>
            <p>{post.attributes.description}</p>
            
            {post.attributes.cover?.data && (
              <img 
                src={getStrapiMediaUrl(post.attributes.cover.data.attributes.url)}
                alt={post.attributes.title}
                width="200"
              />
            )}
            
            <a href={`/posts/${post.attributes.Slug}`}>Read more â†’</a>
            <hr />
          </article>
        ))
      ) : (
        <p>No blog posts found.</p>
      )}
    </main>
  </body>
</html>